{"version":3,"sources":["tiny-fifo.js"],"names":["global","factory","max","ttl","FIFO","constructor","first","items","last","size","has","key","clear","delete","bypass","item","next","prev","evict","get","result","expiry","Date","getTime","value","keys","Object","set","exports","define","amd","fifo","module","window"],"mappings":"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","file":"unknown","sourcesContent":["/**\r\n * Tiny FIFO cache for Client or Server\r\n *\r\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\r\n * @copyright 2019\r\n * @license BSD-3-Clause\r\n * @version 1.0.1\r\n */\r\n\r\n\r\n(function (global) {\r\n\tclass FIFO {\r\n\t\tconstructor (max = 0, ttl = 0) {\r\n\t\t\tthis.first = null;\r\n\t\t\tthis.items = {};\r\n\t\t\tthis.last = null;\r\n\t\t\tthis.max = max;\r\n\t\t\tthis.size = 0;\r\n\t\t\tthis.ttl = ttl;\r\n\t\t}\r\n\r\n\t\thas (key) {\r\n\t\t\treturn key in this.items;\r\n\t\t}\r\n\r\n\t\tclear () {\r\n\t\t\tthis.first = null;\r\n\t\t\tthis.items = {};\r\n\t\t\tthis.last = null;\r\n\t\t\tthis.size = 0;\r\n\t\t}\r\n\r\n\t\tdelete (key, bypass = false) {\r\n\t\t\tif (bypass || this.has(key)) {\r\n\t\t\t\tconst item = this.first;\r\n\r\n\t\t\t\tdelete this.items[key];\r\n\t\t\t\tthis.first = item.next;\r\n\t\t\t\tthis.first.prev = null;\r\n\t\t\t\tthis.size--;\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tevict () {\r\n\t\t\tthis.delete(this.first.key, true);\r\n\t\t}\r\n\r\n\t\tget (key) {\r\n\t\t\tlet result;\r\n\r\n\t\t\tif (this.has(key)) {\r\n\t\t\t\tconst item = this.items[key];\r\n\r\n\t\t\t\tif (this.ttl > 0 && item.expiry >= new Date().getTime()) {\r\n\t\t\t\t\tthis.delete(key);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresult = item.value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tkeys () {\r\n\t\t\treturn Object.keys(this.items);\r\n\t\t}\r\n\r\n\t\tset (key, value) {\r\n\t\t\tif (this.has(key)) {\r\n\t\t\t\tconst item = this.items[key];\r\n\r\n\t\t\t\titem.value = value;\r\n\t\t\t} else {\r\n\t\t\t\tif (this.max > 0 && this.size === this.max) {\r\n\t\t\t\t\tthis.evict();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst item = this.items[key] = {\r\n\t\t\t\t\texpiry: this.ttl > 0 ? new Date().getTime() + this.ttl : this.ttl,\r\n\t\t\t\t\tkey: key,\r\n\t\t\t\t\tprev: this.last,\r\n\t\t\t\t\tnext: null,\r\n\t\t\t\t\tvalue\r\n\t\t\t\t};\r\n\r\n\t\t\t\tif (++this.size === 1) {\r\n\t\t\t\t\tthis.first = item;\r\n\t\t\t\t\tthis.last = item;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.last.next = item;\r\n\t\t\t\t\tthis.last = item;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction factory (max = 1000, ttl = 0) {\r\n\t\treturn new FIFO(max, ttl);\r\n\t}\r\n\r\n\t// Node, AMD & window supported\r\n\tif (typeof exports !== \"undefined\") {\r\n\t\tmodule.exports = factory;\r\n\t} else if (typeof define === \"function\" && define.amd !== void 0) {\r\n\t\tdefine(() => factory);\r\n\t} else {\r\n\t\tglobal.fifo = factory;\r\n\t}\r\n}(typeof window !== \"undefined\" ? window : global));\r\n"]}